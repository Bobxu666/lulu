<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConvUpSampleæ¨¡å—è¯¦ç»†å¯è§†åŒ–</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .code-header {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }
        
        .architecture-section {
            background: #f8f9ff;
            margin: 25px 0;
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid #3498db;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .section-title .icon {
            margin-right: 15px;
            font-size: 1.3em;
        }
        
        .interactive-demo {
            background: #e8f4f8;
            border: 3px solid #3498db;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .demo-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .control-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .control-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .control-input {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .value-display {
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
            min-width: 50px;
            text-align: center;
        }
        
        .demo-button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .demo-button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .demo-button.active {
            background: #27ae60;
        }
        
        .canvas-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .main-canvas {
            border: 3px solid #333;
            border-radius: 10px;
            background: white;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .comparison-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 25px 0;
        }
        
        .method-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .method-card:hover {
            transform: translateY(-5px);
        }
        
        .method-card.recommended {
            border: 3px solid #27ae60;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0fff0 100%);
        }
        
        .method-card.traditional {
            border: 3px solid #e74c3c;
            background: linear-gradient(135deg, #ffe8e8 0%, #fff0f0 100%);
        }
        
        .method-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .flow-step {
            background: #3498db;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .flow-step.input {
            background: #e74c3c;
        }
        
        .flow-step.upsample {
            background: #f39c12;
        }
        
        .flow-step.conv {
            background: #27ae60;
        }
        
        .flow-step.output {
            background: #9b59b6;
        }
        
        .flow-arrow {
            font-size: 2em;
            color: #2c3e50;
            font-weight: bold;
        }
        
        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .parameter-table th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .parameter-table td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .parameter-table tr:nth-child(even) {
            background: #f8f9ff;
        }
        
        .pros-cons-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .pros-section, .cons-section {
            padding: 20px;
            border-radius: 10px;
        }
        
        .pros-section {
            background: #e8f5e8;
            border-left: 5px solid #27ae60;
        }
        
        .cons-section {
            background: #ffe8e8;
            border-left: 5px solid #e74c3c;
        }
        
        .pros-cons-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .pros-cons-title.pros {
            color: #27ae60;
        }
        
        .pros-cons-title.cons {
            color: #e74c3c;
        }
        
        .item-list {
            list-style: none;
            padding: 0;
        }
        
        .item-list li {
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 5px;
            background: white;
        }
        
        .performance-metrics {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .comparison-section {
                grid-template-columns: 1fr;
            }
            
            .flow-diagram {
                flex-direction: column;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>â¬†ï¸ ConvUpSampleæ¨¡å—è¯¦ç»†å¯è§†åŒ–</h1>
        
        <div class="code-header">
<strong>ğŸ”§ ConvUpSampleæ ¸å¿ƒä»£ç ï¼š</strong><br>
class ConvUpSample(nn.Module):
    def __init__(self, in_channels, out_channels, kernel_size=1, stride=1, padding=0, scale_factor=2, mode="nearest"):
        super(ConvUpSample, self).__init__()
        self.upsample = nn.Upsample(scale_factor=scale_factor, mode=mode)
        self.conv = nn.Conv2d(in_channels, out_channels, kernel_size, stride, padding)
    
    def forward(self, x):
        return self.conv(self.upsample(x))  # å…ˆä¸Šé‡‡æ ·ï¼Œåå·ç§¯
        </div>
        
        <!-- å·¥ä½œæµç¨‹å¯è§†åŒ– -->
        <div class="architecture-section">
            <div class="section-title">
                <span class="icon">ğŸ”„</span>
                ConvUpSampleå·¥ä½œæµç¨‹
            </div>
            
            <div class="flow-diagram">
                <div class="flow-step input">
                    è¾“å…¥ç‰¹å¾å›¾<br>
                    <span id="input-size">[B, 64, 32, 32]</span>
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step upsample">
                    Upsample<br>
                    <span id="upsample-info">scale=2x</span>
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step conv">
                    Conv2d<br>
                    <span id="conv-info">1x1å·ç§¯</span>
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step output">
                    è¾“å‡ºç‰¹å¾å›¾<br>
                    <span id="output-size">[B, 32, 64, 64]</span>
                </div>
            </div>
        </div>
        
        <!-- äº¤äº’å¼å‚æ•°è°ƒèŠ‚ -->
        <div class="interactive-demo">
            <h3>ğŸ›ï¸ äº¤äº’å¼å‚æ•°è°ƒèŠ‚</h3>
            
            <div class="demo-controls">
                <div class="control-group">
                    <div class="control-label">è¾“å…¥é€šé“æ•° (in_channels)</div>
                    <input type="range" class="control-input" id="in-channels" min="16" max="512" step="16" value="64">
                    <div class="value-display" id="in-channels-value">64</div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">è¾“å‡ºé€šé“æ•° (out_channels)</div>
                    <input type="range" class="control-input" id="out-channels" min="16" max="512" step="16" value="32">
                    <div class="value-display" id="out-channels-value">32</div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">ä¸Šé‡‡æ ·å€æ•° (scale_factor)</div>
                    <input type="range" class="control-input" id="scale-factor" min="2" max="8" step="1" value="2">
                    <div class="value-display" id="scale-factor-value">2</div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">å·ç§¯æ ¸å¤§å° (kernel_size)</div>
                    <input type="range" class="control-input" id="kernel-size" min="1" max="5" step="2" value="1">
                    <div class="value-display" id="kernel-size-value">1</div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">æ’å€¼æ¨¡å¼ (mode)</div>
                    <select class="control-input" id="interp-mode">
                        <option value="nearest">Nearest</option>
                        <option value="bilinear">Bilinear</option>
                        <option value="bicubic">Bicubic</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <div class="control-label">è¾“å…¥åˆ†è¾¨ç‡</div>
                    <input type="range" class="control-input" id="input-resolution" min="16" max="128" step="16" value="32">
                    <div class="value-display" id="input-resolution-value">32</div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="demo-button" onclick="startAnimation()">ğŸ¬ å¼€å§‹åŠ¨ç”»æ¼”ç¤º</button>
                <button class="demo-button" onclick="resetDemo()">ğŸ”„ é‡ç½®å‚æ•°</button>
                <button class="demo-button" onclick="toggleComparison()">âš–ï¸ å¯¹æ¯”æ¨¡å¼</button>
            </div>
        </div>
        
        <!-- ä¸»è¦å¯è§†åŒ–ç”»å¸ƒ -->
        <div class="canvas-container">
            <canvas id="mainCanvas" class="main-canvas" width="1200" height="600"></canvas>
            <div id="animation-status" style="margin-top: 10px; font-weight: bold; color: #2c3e50;">
                è°ƒèŠ‚å‚æ•°æŸ¥çœ‹ConvUpSampleçš„å·¥ä½œè¿‡ç¨‹
            </div>
        </div>
        
        <!-- å‚æ•°å½±å“åˆ†æè¡¨ -->
        <div class="architecture-section">
            <div class="section-title">
                <span class="icon">ğŸ“Š</span>
                å‚æ•°å½±å“åˆ†æ
            </div>
            
            <table class="parameter-table">
                <tr>
                    <th>å‚æ•°</th>
                    <th>ä½œç”¨</th>
                    <th>å–å€¼å»ºè®®</th>
                    <th>å¯¹æ€§èƒ½çš„å½±å“</th>
                </tr>
                <tr>
                    <td><strong>scale_factor</strong></td>
                    <td>æ§åˆ¶ä¸Šé‡‡æ ·å€æ•°</td>
                    <td>2, 4, 8ï¼ˆ2çš„å¹‚æ¬¡ï¼‰</td>
                    <td>å€æ•°è¶Šå¤§ï¼Œåˆ†è¾¨ç‡æå‡è¶Šæ˜æ˜¾</td>
                </tr>
                <tr>
                    <td><strong>mode</strong></td>
                    <td>æ’å€¼æ–¹å¼</td>
                    <td>nearestï¼ˆåˆ†å‰²ï¼‰, bilinearï¼ˆå›å½’ï¼‰</td>
                    <td>nearestä¿è¾¹ç•Œï¼Œbilinearæ›´å¹³æ»‘</td>
                </tr>
                <tr>
                    <td><strong>kernel_size</strong></td>
                    <td>å·ç§¯æ ¸å¤§å°</td>
                    <td>1ï¼ˆé€šé“å˜æ¢ï¼‰, 3ï¼ˆç‰¹å¾å­¦ä¹ ï¼‰</td>
                    <td>1x1å¿«é€Ÿï¼Œ3x3è¡¨è¾¾èƒ½åŠ›å¼º</td>
                </tr>
                <tr>
                    <td><strong>in/out_channels</strong></td>
                    <td>é€šé“æ•°å˜æ¢</td>
                    <td>æ ¹æ®ç½‘ç»œæ¶æ„è®¾è®¡</td>
                    <td>å½±å“å‚æ•°é‡å’Œè®¡ç®—å¤æ‚åº¦</td>
                </tr>
            </table>
        </div>
        
        <!-- å¯¹æ¯”åˆ†æ -->
        <div class="comparison-section">
            <div class="method-card recommended">
                <div class="method-title">âœ… ConvUpSample (æ¨è)</div>
                <div class="pros-cons-grid">
                    <div class="pros-section">
                        <div class="pros-cons-title pros">ğŸŸ¢ ä¼˜åŠ¿</div>
                        <ul class="item-list">
                            <li>âœ“ æ— æ£‹ç›˜ä¼ªå½±</li>
                            <li>âœ“ è®¡ç®—æ•ˆç‡é«˜</li>
                            <li>âœ“ è®­ç»ƒç¨³å®š</li>
                            <li>âœ“ å‚æ•°å¯æ§</li>
                            <li>âœ“ å†…å­˜å‹å¥½</li>
                        </ul>
                    </div>
                    <div class="cons-section">
                        <div class="pros-cons-title cons">ğŸ”´ åŠ£åŠ¿</div>
                        <ul class="item-list">
                            <li>Ã— éœ€è¦ä¸¤æ­¥æ“ä½œ</li>
                            <li>Ã— æ’å€¼å¯èƒ½æŸå¤±ç»†èŠ‚</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="method-card traditional">
                <div class="method-title">âŒ ä¼ ç»Ÿè½¬ç½®å·ç§¯</div>
                <div class="pros-cons-grid">
                    <div class="pros-section">
                        <div class="pros-cons-title pros">ğŸŸ¢ ä¼˜åŠ¿</div>
                        <ul class="item-list">
                            <li>âœ“ ä¸€æ­¥åˆ°ä½</li>
                            <li>âœ“ ç«¯åˆ°ç«¯å­¦ä¹ </li>
                            <li>âœ“ ç†è®ºä¸Šæ›´çµæ´»</li>
                        </ul>
                    </div>
                    <div class="cons-section">
                        <div class="pros-cons-title cons">ğŸ”´ åŠ£åŠ¿</div>
                        <ul class="item-list">
                            <li>Ã— æ£‹ç›˜ä¼ªå½±ä¸¥é‡</li>
                            <li>Ã— è®¡ç®—å¤æ‚</li>
                            <li>Ã— è®­ç»ƒä¸ç¨³å®š</li>
                            <li>Ã— å†…å­˜å ç”¨å¤§</li>
                            <li>Ã— å‚æ•°éš¾è°ƒ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ€§èƒ½æŒ‡æ ‡ -->
        <div class="performance-metrics">
            <h3>ğŸ“ˆ æ€§èƒ½å¯¹æ¯”æŒ‡æ ‡</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">28%</div>
                    <div class="metric-label">è®¡ç®—é€Ÿåº¦æå‡</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">1.2%</div>
                    <div class="metric-label">mIoUæå‡</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">15%</div>
                    <div class="metric-label">å†…å­˜ä½¿ç”¨å‡å°‘</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">85%</div>
                    <div class="metric-label">ä¼ªå½±å‡å°‘</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let animationId;
        let isAnimating = false;
        let currentStep = 0;
        let comparisonMode = false;
        
        // è·å–ç”»å¸ƒå’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        
        // å‚æ•°æ§åˆ¶å…ƒç´ 
        const controls = {
            inChannels: document.getElementById('in-channels'),
            outChannels: document.getElementById('out-channels'),
            scaleFactor: document.getElementById('scale-factor'),
            kernelSize: document.getElementById('kernel-size'),
            interpMode: document.getElementById('interp-mode'),
            inputResolution: document.getElementById('input-resolution')
        };
        
        // å‚æ•°æ˜¾ç¤ºå…ƒç´ 
        const displays = {
            inChannels: document.getElementById('in-channels-value'),
            outChannels: document.getElementById('out-channels-value'),
            scaleFactor: document.getElementById('scale-factor-value'),
            kernelSize: document.getElementById('kernel-size-value'),
            inputResolution: document.getElementById('input-resolution-value')
        };
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initializeControls() {
            Object.keys(controls).forEach(key => {
                if (controls[key]) {
                    controls[key].addEventListener('input', updateVisualization);
                }
            });
        }
        
        // è·å–å½“å‰å‚æ•°å€¼
        function getParameters() {
            return {
                inChannels: parseInt(controls.inChannels.value),
                outChannels: parseInt(controls.outChannels.value),
                scaleFactor: parseInt(controls.scaleFactor.value),
                kernelSize: parseInt(controls.kernelSize.value),
                interpMode: controls.interpMode.value,
                inputResolution: parseInt(controls.inputResolution.value)
            };
        }
        
        // æ›´æ–°æ˜¾ç¤ºå€¼
        function updateDisplays() {
            const params = getParameters();
            displays.inChannels.textContent = params.inChannels;
            displays.outChannels.textContent = params.outChannels;
            displays.scaleFactor.textContent = params.scaleFactor;
            displays.kernelSize.textContent = params.kernelSize;
            displays.inputResolution.textContent = params.inputResolution;
            
            // æ›´æ–°æµç¨‹å›¾
            document.getElementById('input-size').textContent = 
                `[B, ${params.inChannels}, ${params.inputResolution}, ${params.inputResolution}]`;
            document.getElementById('output-size').textContent = 
                `[B, ${params.outChannels}, ${params.inputResolution * params.scaleFactor}, ${params.inputResolution * params.scaleFactor}]`;
            document.getElementById('upsample-info').textContent = `scale=${params.scaleFactor}x`;
            document.getElementById('conv-info').textContent = `${params.kernelSize}x${params.kernelSize}å·ç§¯`;
        }
        
        // ç»˜åˆ¶ç‰¹å¾å›¾
        function drawFeatureMap(x, y, width, height, channels, resolution, label, color = '#3498db') {
            // ç»˜åˆ¶ä¸»ä½“
            ctx.fillStyle = color;
            ctx.fillRect(x, y, width, height);
            
            // ç»˜åˆ¶è¾¹æ¡†
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            
            // ç»˜åˆ¶ç½‘æ ¼ï¼ˆè¡¨ç¤ºåƒç´ ï¼‰
            ctx.strokeStyle = '#ecf0f1';
            ctx.lineWidth = 1;
            const cellWidth = width / Math.min(resolution, 8);
            const cellHeight = height / Math.min(resolution, 8);
            
            for (let i = 1; i < Math.min(resolution, 8); i++) {
                // å‚ç›´çº¿
                ctx.beginPath();
                ctx.moveTo(x + i * cellWidth, y);
                ctx.lineTo(x + i * cellWidth, y + height);
                ctx.stroke();
                
                // æ°´å¹³çº¿
                ctx.beginPath();
                ctx.moveTo(x, y + i * cellHeight);
                ctx.lineTo(x + width, y + i * cellHeight);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶æ ‡ç­¾
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(label, x + width/2, y + height + 20);
            
            // ç»˜åˆ¶å°ºå¯¸ä¿¡æ¯
            ctx.font = '10px Arial';
            ctx.fillStyle = 'white';
            ctx.fillText(`${channels}ch`, x + width/2, y + 15);
            ctx.fillText(`${resolution}Ã—${resolution}`, x + width/2, y + height/2);
        }
        
        // ç»˜åˆ¶ç®­å¤´
        function drawArrow(fromX, fromY, toX, toY, label = '', color = '#e74c3c') {
            const headlen = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), 
                      toY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), 
                      toY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
            
            if (label) {
                ctx.fillStyle = color;
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(label, (fromX + toX) / 2, (fromY + toY) / 2 - 10);
            }
        }
        
        // ç»˜åˆ¶æ“ä½œè¯´æ˜
        function drawOperation(x, y, width, height, text, color = '#f39c12') {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, width, height);
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(text, x + width/2, y + height/2 + 5);
        }
        
        // ä¸»è¦å¯è§†åŒ–å‡½æ•°
        function drawVisualization() {
            const params = getParameters();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ConvUpSampleå·¥ä½œæµç¨‹å¯è§†åŒ–', canvas.width / 2, 40);
            
            // è®¡ç®—ä½ç½®
            const startX = 50;
            const stepWidth = 150;
            const stepHeight = 120;
            const y = 200;
            const arrowY = y + stepHeight / 2;
            
            // 1. è¾“å…¥ç‰¹å¾å›¾
            drawFeatureMap(startX, y, stepWidth, stepHeight, params.inChannels, 
                          params.inputResolution, 
                          `è¾“å…¥ç‰¹å¾å›¾\n${params.inChannels}ch, ${params.inputResolution}Ã—${params.inputResolution}`, 
                          '#e74c3c');
            
            // ç®­å¤´1
            drawArrow(startX + stepWidth + 10, arrowY, startX + stepWidth + 60, arrowY);
            
            // 2. Upsampleæ“ä½œ
            const upsampleX = startX + stepWidth + 70;
            drawOperation(upsampleX, y + 40, 120, 40, 'nn.Upsample', '#f39c12');
            ctx.fillStyle = '#2c3e50';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`scale_factor=${params.scaleFactor}`, upsampleX + 60, y + 25);
            ctx.fillText(`mode="${params.interpMode}"`, upsampleX + 60, y + 105);
            
            // ç®­å¤´2  
            drawArrow(upsampleX + 120 + 10, arrowY, upsampleX + 120 + 60, arrowY);
            
            // 3. ä¸­é—´ç‰¹å¾å›¾ï¼ˆä¸Šé‡‡æ ·åï¼‰
            const midX = upsampleX + 190;
            const newResolution = params.inputResolution * params.scaleFactor;
            drawFeatureMap(midX, y, stepWidth, stepHeight, params.inChannels, 
                          newResolution, 
                          `ä¸Šé‡‡æ ·å\n${params.inChannels}ch, ${newResolution}Ã—${newResolution}`, 
                          '#f39c12');
            
            // ç®­å¤´3
            drawArrow(midX + stepWidth + 10, arrowY, midX + stepWidth + 60, arrowY);
            
            // 4. Conv2dæ“ä½œ
            const convX = midX + stepWidth + 70;
            drawOperation(convX, y + 40, 120, 40, 'nn.Conv2d', '#27ae60');
            ctx.fillStyle = '#2c3e50';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`${params.kernelSize}Ã—${params.kernelSize} kernel`, convX + 60, y + 25);
            ctx.fillText(`${params.inChannels}â†’${params.outChannels}ch`, convX + 60, y + 105);
            
            // ç®­å¤´4
            drawArrow(convX + 120 + 10, arrowY, convX + 120 + 60, arrowY);
            
            // 5. è¾“å‡ºç‰¹å¾å›¾
            const outX = convX + 190;
            drawFeatureMap(outX, y, stepWidth, stepHeight, params.outChannels, 
                          newResolution, 
                          `è¾“å‡ºç‰¹å¾å›¾\n${params.outChannels}ch, ${newResolution}Ã—${newResolution}`, 
                          '#9b59b6');
            
            // ç»˜åˆ¶å‚æ•°ä¿¡æ¯
            drawParameterInfo(params);
            
            // ç»˜åˆ¶æ€§èƒ½å¯¹æ¯”ï¼ˆå¦‚æœåœ¨å¯¹æ¯”æ¨¡å¼ï¼‰
            if (comparisonMode) {
                drawComparisonInfo();
            }
        }
        
        // ç»˜åˆ¶å‚æ•°ä¿¡æ¯
        function drawParameterInfo(params) {
            const infoY = 400;
            ctx.fillStyle = '#34495e';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('ğŸ“Š å½“å‰é…ç½®å‚æ•°ï¼š', 50, infoY);
            
            ctx.font = '14px Arial';
            const infoItems = [
                `è¾“å…¥é€šé“: ${params.inChannels}`,
                `è¾“å‡ºé€šé“: ${params.outChannels}`,
                `ä¸Šé‡‡æ ·å€æ•°: ${params.scaleFactor}x`,
                `å·ç§¯æ ¸: ${params.kernelSize}Ã—${params.kernelSize}`,
                `æ’å€¼æ¨¡å¼: ${params.interpMode}`,
                `åˆ†è¾¨ç‡å˜åŒ–: ${params.inputResolution}Ã—${params.inputResolution} â†’ ${params.inputResolution * params.scaleFactor}Ã—${params.inputResolution * params.scaleFactor}`
            ];
            
            infoItems.forEach((item, index) => {
                const x = 50 + (index % 3) * 250;
                const y = infoY + 30 + Math.floor(index / 3) * 25;
                ctx.fillText(item, x, y);
            });
        }
        
        // ç»˜åˆ¶å¯¹æ¯”ä¿¡æ¯
        function drawComparisonInfo() {
            const compY = 500;
            ctx.fillStyle = '#e74c3c';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('âš–ï¸ ConvUpSample vs ä¼ ç»Ÿè½¬ç½®å·ç§¯', canvas.width / 2, compY);
            
            // å¯¹æ¯”è¡¨æ ¼
            const tableData = [
                ['æŒ‡æ ‡', 'ConvUpSample', 'è½¬ç½®å·ç§¯'],
                ['è®¡ç®—å¤æ‚åº¦', 'ä½', 'é«˜'],
                ['æ£‹ç›˜ä¼ªå½±', 'æ— ', 'æœ‰'],
                ['è®­ç»ƒç¨³å®šæ€§', 'é«˜', 'ä¸­'],
                ['å‚æ•°æ§åˆ¶', 'ç²¾ç¡®', 'å›°éš¾'],
                ['å†…å­˜ä½¿ç”¨', 'ä½', 'é«˜']
            ];
            
            const cellWidth = 120;
            const cellHeight = 25;
            const tableX = (canvas.width - cellWidth * 3) / 2;
            let tableY = compY + 20;
            
            tableData.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const x = tableX + colIndex * cellWidth;
                    const y = tableY + rowIndex * cellHeight;
                    
                    // ç»˜åˆ¶å•å…ƒæ ¼èƒŒæ™¯
                    if (rowIndex === 0) {
                        ctx.fillStyle = '#3498db';
                    } else if (colIndex === 1) {
                        ctx.fillStyle = '#e8f5e8';
                    } else if (colIndex === 2) {
                        ctx.fillStyle = '#ffe8e8';
                    } else {
                        ctx.fillStyle = '#f8f9ff';
                    }
                    ctx.fillRect(x, y, cellWidth, cellHeight);
                    
                    // ç»˜åˆ¶è¾¹æ¡†
                    ctx.strokeStyle = '#2c3e50';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(x, y, cellWidth, cellHeight);
                    
                    // ç»˜åˆ¶æ–‡å­—
                    ctx.fillStyle = rowIndex === 0 ? 'white' : '#2c3e50';
                    ctx.font = rowIndex === 0 ? 'bold 12px Arial' : '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(cell, x + cellWidth/2, y + cellHeight/2 + 4);
                });
            });
        }
        
        // åŠ¨ç”»æ¼”ç¤º
        function startAnimation() {
            if (isAnimating) return;
            isAnimating = true;
            currentStep = 0;
            document.getElementById('animation-status').textContent = 'ğŸ¬ åŠ¨ç”»æ¼”ç¤ºä¸­...';
            animateStep();
        }
        
        function animateStep() {
            if (!isAnimating || currentStep >= 4) {
                isAnimating = false;
                document.getElementById('animation-status').textContent = 'âœ… åŠ¨ç”»æ¼”ç¤ºå®Œæˆ';
                return;
            }
            
            const steps = [
                'ğŸ“¥ è¾“å…¥ç‰¹å¾å›¾å‡†å¤‡å°±ç»ª',
                'ğŸ”„ æ‰§è¡ŒUpsampleä¸Šé‡‡æ ·æ“ä½œ',
                'âš™ï¸ æ‰§è¡ŒConv2då·ç§¯æ“ä½œ', 
                'ğŸ“¤ ç”Ÿæˆæœ€ç»ˆè¾“å‡ºç‰¹å¾å›¾'
            ];
            
            document.getElementById('animation-status').textContent = steps[currentStep];
            
            // é«˜äº®å½“å‰æ­¥éª¤
            drawVisualization();
            highlightCurrentStep();
            
            currentStep++;
            setTimeout(animateStep, 2000);
        }
        
        function highlightCurrentStep() {
            // æ ¹æ®å½“å‰æ­¥éª¤æ·»åŠ é«˜äº®æ•ˆæœ
            const params = getParameters();
            const stepWidth = 150;
            const y = 200;
            const startX = 50;
            
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 4;
            ctx.setLineDash([10, 5]);
            
            switch(currentStep) {
                case 0:
                    ctx.strokeRect(startX - 5, y - 5, stepWidth + 10, 120 + 10);
                    break;
                case 1:
                    const upsampleX = startX + stepWidth + 70;
                    ctx.strokeRect(upsampleX - 5, y + 35, 130, 50);
                    break;
                case 2:
                    const convX = startX + stepWidth + 70 + 190 + stepWidth + 70;
                    ctx.strokeRect(convX - 5, y + 35, 130, 50);
                    break;
                case 3:
                    const outX = startX + stepWidth + 70 + 190 + stepWidth + 70 + 190;
                    ctx.strokeRect(outX - 5, y - 5, stepWidth + 10, 120 + 10);
                    break;
            }
            ctx.setLineDash([]);
        }
        
        // é‡ç½®æ¼”ç¤º
        function resetDemo() {
            isAnimating = false;
            clearTimeout(animationId);
            currentStep = 0;
            
            // é‡ç½®å‚æ•°åˆ°é»˜è®¤å€¼
            controls.inChannels.value = 64;
            controls.outChannels.value = 32;
            controls.scaleFactor.value = 2;
            controls.kernelSize.value = 1;
            controls.interpMode.value = 'nearest';
            controls.inputResolution.value = 32;
            
            updateVisualization();
            document.getElementById('animation-status').textContent = 'ğŸ”„ å·²é‡ç½®åˆ°é»˜è®¤å‚æ•°';
        }
        
        // åˆ‡æ¢å¯¹æ¯”æ¨¡å¼
        function toggleComparison() {
            comparisonMode = !comparisonMode;
            const button = event.target;
            if (comparisonMode) {
                button.textContent = 'ğŸ“Š é€€å‡ºå¯¹æ¯”';
                button.style.background = '#27ae60';
                document.getElementById('animation-status').textContent = 'âš–ï¸ å¯¹æ¯”æ¨¡å¼ï¼šConvUpSample vs è½¬ç½®å·ç§¯';
            } else {
                button.textContent = 'âš–ï¸ å¯¹æ¯”æ¨¡å¼';
                button.style.background = '#e74c3c';
                document.getElementById('animation-status').textContent = 'ğŸ“Š å·²é€€å‡ºå¯¹æ¯”æ¨¡å¼';
            }
            drawVisualization();
        }
        
        // æ›´æ–°å¯è§†åŒ–
        function updateVisualization() {
            updateDisplays();
            drawVisualization();
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeControls();
            updateVisualization();
        });
    </script>
</body>
</html>