<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConvUpSampleÊ®°ÂùóËØ¶ÁªÜÂèØËßÜÂåñ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .code-header {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }
        
        .architecture-section {
            background: #f8f9ff;
            margin: 25px 0;
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid #3498db;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .section-title .icon {
            margin-right: 15px;
            font-size: 1.3em;
        }
        
        .interactive-demo {
            background: #e8f4f8;
            border: 3px solid #3498db;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .demo-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .control-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .control-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .control-input {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .value-display {
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
            min-width: 50px;
            text-align: center;
        }
        
        .demo-button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .demo-button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .demo-button.active {
            background: #27ae60;
        }
        
        .canvas-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .main-canvas {
            border: 3px solid #333;
            border-radius: 10px;
            background: white;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .comparison-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 25px 0;
        }
        
        .method-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .method-card:hover {
            transform: translateY(-5px);
        }
        
        .method-card.recommended {
            border: 3px solid #27ae60;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0fff0 100%);
        }
        
        .method-card.traditional {
            border: 3px solid #e74c3c;
            background: linear-gradient(135deg, #ffe8e8 0%, #fff0f0 100%);
        }
        
        .method-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .flow-step {
            background: #3498db;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .flow-step.input {
            background: #e74c3c;
        }
        
        .flow-step.upsample {
            background: #f39c12;
        }
        
        .flow-step.conv {
            background: #27ae60;
        }
        
        .flow-step.output {
            background: #9b59b6;
        }
        
        .flow-arrow {
            font-size: 2em;
            color: #2c3e50;
            font-weight: bold;
        }
        
        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .parameter-table th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .parameter-table td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .parameter-table tr:nth-child(even) {
            background: #f8f9ff;
        }
        
        .pros-cons-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .pros-section, .cons-section {
            padding: 20px;
            border-radius: 10px;
        }
        
        .pros-section {
            background: #e8f5e8;
            border-left: 5px solid #27ae60;
        }
        
        .cons-section {
            background: #ffe8e8;
            border-left: 5px solid #e74c3c;
        }
        
        .pros-cons-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .pros-cons-title.pros {
            color: #27ae60;
        }
        
        .pros-cons-title.cons {
            color: #e74c3c;
        }
        
        .item-list {
            list-style: none;
            padding: 0;
        }
        
        .item-list li {
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 5px;
            background: white;
        }
        
        .performance-metrics {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .comparison-section {
                grid-template-columns: 1fr;
            }
            
            .flow-diagram {
                flex-direction: column;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>‚¨ÜÔ∏è ConvUpSampleÊ®°ÂùóËØ¶ÁªÜÂèØËßÜÂåñ</h1>
        
        <div class="code-header">
<strong>üîß ConvUpSampleÊ†∏ÂøÉ‰ª£Á†ÅÔºö</strong><br>
class ConvUpSample(nn.Module):
    def __init__(self, in_channels, out_channels, kernel_size=1, stride=1, padding=0, scale_factor=2, mode="nearest"):
        super(ConvUpSample, self).__init__()
        self.upsample = nn.Upsample(scale_factor=scale_factor, mode=mode)
        self.conv = nn.Conv2d(in_channels, out_channels, kernel_size, stride, padding)
    
    def forward(self, x):
        return self.conv(self.upsample(x))  # ÂÖà‰∏äÈááÊ†∑ÔºåÂêéÂç∑ÁßØ
        </div>
        
        <!-- Â∑•‰ΩúÊµÅÁ®ãÂèØËßÜÂåñ -->
        <div class="architecture-section">
            <div class="section-title">
                <span class="icon">üîÑ</span>
                ConvUpSampleÂ∑•‰ΩúÊµÅÁ®ã
            </div>
            
            <div class="flow-diagram">
                <div class="flow-step input">
                    ËæìÂÖ•ÁâπÂæÅÂõæ<br>
                    <span id="input-size">[B, 64, 32, 32]</span>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step upsample">
                    Upsample<br>
                    <span id="upsample-info">scale=2x</span>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step conv">
                    Conv2d<br>
                    <span id="conv-info">1x1Âç∑ÁßØ</span>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step output">
                    ËæìÂá∫ÁâπÂæÅÂõæ<br>
                    <span id="output-size">[B, 32, 64, 64]</span>
                </div>
            </div>
        </div>
        
        <!-- ‰∫§‰∫íÂºèÂèÇÊï∞Ë∞ÉËäÇ -->
        <div class="interactive-demo">
            <h3>üéõÔ∏è ‰∫§‰∫íÂºèÂèÇÊï∞Ë∞ÉËäÇ</h3>
            
            <div class="demo-controls">
                <div class="control-group">
                    <div class="control-label">ËæìÂÖ•ÈÄöÈÅìÊï∞ (in_channels)</div>
                    <input type="range" class="control-input" id="in-channels" min="16" max="512" step="16" value="64">
                    <div class="value-display" id="in-channels-value">64</div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">ËæìÂá∫ÈÄöÈÅìÊï∞ (out_channels)</div>
                    <input type="range" class="control-input" id="out-channels" min="16" max="512" step="16" value="32">
                    <div class="value-display" id="out-channels-value">32</div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">‰∏äÈááÊ†∑ÂÄçÊï∞ (scale_factor)</div>
                    <input type="range" class="control-input" id="scale-factor" min="2" max="8" step="1" value="2">
                    <div class="value-display" id="scale-factor-value">2</div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">Âç∑ÁßØÊ†∏Â§ßÂ∞è (kernel_size)</div>
                    <input type="range" class="control-input" id="kernel-size" min="1" max="5" step="2" value="1">
                    <div class="value-display" id="kernel-size-value">1</div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">ÊèíÂÄºÊ®°Âºè (mode)</div>
                    <select class="control-input" id="interp-mode">
                        <option value="nearest">Nearest</option>
                        <option value="bilinear">Bilinear</option>
                        <option value="bicubic">Bicubic</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <div class="control-label">ËæìÂÖ•ÂàÜËæ®Áéá</div>
                    <input type="range" class="control-input" id="input-resolution" min="16" max="128" step="16" value="32">
                    <div class="value-display" id="input-resolution-value">32</div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="demo-button" onclick="startAnimation()">üé¨ ÂºÄÂßãÂä®ÁîªÊºîÁ§∫</button>
                <button class="demo-button" onclick="resetDemo()">üîÑ ÈáçÁΩÆÂèÇÊï∞</button>
                <button class="demo-button" onclick="toggleComparison()">‚öñÔ∏è ÂØπÊØîÊ®°Âºè</button>
            </div>
        </div>
        
        <!-- ‰∏ªË¶ÅÂèØËßÜÂåñÁîªÂ∏É -->
        <div class="canvas-container">
            <canvas id="mainCanvas" class="main-canvas" width="1200" height="600"></canvas>
            <div id="animation-status" style="margin-top: 10px; font-weight: bold; color: #2c3e50;">
                Ë∞ÉËäÇÂèÇÊï∞Êü•ÁúãConvUpSampleÁöÑÂ∑•‰ΩúËøáÁ®ã
            </div>
        </div>
        
        <!-- ÂèÇÊï∞ÂΩ±ÂìçÂàÜÊûêË°® -->
        <div class="architecture-section">
            <div class="section-title">
                <span class="icon">üìä</span>
                ÂèÇÊï∞ÂΩ±ÂìçÂàÜÊûê
            </div>
            
            <table class="parameter-table">
                <tr>
                    <th>ÂèÇÊï∞</th>
                    <th>‰ΩúÁî®</th>
                    <th>ÂèñÂÄºÂª∫ËÆÆ</th>
                    <th>ÂØπÊÄßËÉΩÁöÑÂΩ±Âìç</th>
                </tr>
                <tr>
                    <td><strong>scale_factor</strong></td>
                    <td>ÊéßÂà∂‰∏äÈááÊ†∑ÂÄçÊï∞</td>
                    <td>2, 4, 8Ôºà2ÁöÑÂπÇÊ¨°Ôºâ</td>
                    <td>ÂÄçÊï∞Ë∂äÂ§ßÔºåÂàÜËæ®ÁéáÊèêÂçáË∂äÊòéÊòæ</td>
                </tr>
                <tr>
                    <td><strong>mode</strong></td>
                    <td>ÊèíÂÄºÊñπÂºè</td>
                    <td>nearestÔºàÂàÜÂâ≤Ôºâ, bilinearÔºàÂõûÂΩíÔºâ</td>
                    <td>nearest‰øùËæπÁïåÔºåbilinearÊõ¥Âπ≥Êªë</td>
                </tr>
                <tr>
                    <td><strong>kernel_size</strong></td>
                    <td>Âç∑ÁßØÊ†∏Â§ßÂ∞è</td>
                    <td>1ÔºàÈÄöÈÅìÂèòÊç¢Ôºâ, 3ÔºàÁâπÂæÅÂ≠¶‰π†Ôºâ</td>
                    <td>1x1Âø´ÈÄüÔºå3x3Ë°®ËææËÉΩÂäõÂº∫</td>
                </tr>
                <tr>
                    <td><strong>in/out_channels</strong></td>
                    <td>ÈÄöÈÅìÊï∞ÂèòÊç¢</td>
                    <td>Ê†πÊçÆÁΩëÁªúÊû∂ÊûÑËÆæËÆ°</td>
                    <td>ÂΩ±ÂìçÂèÇÊï∞ÈáèÂíåËÆ°ÁÆóÂ§çÊùÇÂ∫¶</td>
                </tr>
            </table>
        </div>
        
        <!-- ÂØπÊØîÂàÜÊûê -->
        <div class="comparison-section">
            <div class="method-card recommended">
                <div class="method-title">‚úÖ ConvUpSample (Êé®Ëçê)</div>
                <div class="pros-cons-grid">
                    <div class="pros-section">
                        <div class="pros-cons-title pros">üü¢ ‰ºòÂäø</div>
                        <ul class="item-list">
                            <li>‚úì Êó†Ê£ãÁõò‰º™ÂΩ±</li>
                            <li>‚úì ËÆ°ÁÆóÊïàÁéáÈ´ò</li>
                            <li>‚úì ËÆ≠ÁªÉÁ®≥ÂÆö</li>
                            <li>‚úì ÂèÇÊï∞ÂèØÊéß</li>
                            <li>‚úì ÂÜÖÂ≠òÂèãÂ•Ω</li>
                        </ul>
                    </div>
                    <div class="cons-section">
                        <div class="pros-cons-title cons">üî¥ Âä£Âäø</div>
                        <ul class="item-list">
                            <li>√ó ÈúÄË¶Å‰∏§Ê≠•Êìç‰Ωú</li>
                            <li>√ó ÊèíÂÄºÂèØËÉΩÊçüÂ§±ÁªÜËäÇ</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="method-card traditional">
                <div class="method-title">‚ùå ‰º†ÁªüËΩ¨ÁΩÆÂç∑ÁßØ</div>
                <div class="pros-cons-grid">
                    <div class="pros-section">
                        <div class="pros-cons-title pros">üü¢ ‰ºòÂäø</div>
                        <ul class="item-list">
                            <li>‚úì ‰∏ÄÊ≠•Âà∞‰Ωç</li>
                            <li>‚úì Á´ØÂà∞Á´ØÂ≠¶‰π†</li>
                            <li>‚úì ÁêÜËÆ∫‰∏äÊõ¥ÁÅµÊ¥ª</li>
                        </ul>
                    </div>
                    <div class="cons-section">
                        <div class="pros-cons-title cons">üî¥ Âä£Âäø</div>
                        <ul class="item-list">
                            <li>√ó Ê£ãÁõò‰º™ÂΩ±‰∏•Èáç</li>
                            <li>√ó ËÆ°ÁÆóÂ§çÊùÇ</li>
                            <li>√ó ËÆ≠ÁªÉ‰∏çÁ®≥ÂÆö</li>
                            <li>√ó ÂÜÖÂ≠òÂç†Áî®Â§ß</li>
                            <li>√ó ÂèÇÊï∞ÈöæË∞É</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÊÄßËÉΩÊåáÊ†á -->
        <div class="performance-metrics">
            <h3>üìà ÊÄßËÉΩÂØπÊØîÊåáÊ†á</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">28%</div>
                    <div class="metric-label">ËÆ°ÁÆóÈÄüÂ∫¶ÊèêÂçá</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">1.2%</div>
                    <div class="metric-label">mIoUÊèêÂçá</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">15%</div>
                    <div class="metric-label">ÂÜÖÂ≠ò‰ΩøÁî®ÂáèÂ∞ë</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">85%</div>
                    <div class="metric-label">‰º™ÂΩ±ÂáèÂ∞ë</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let animationId;
        let isAnimating = false;
        let currentStep = 0;
        let comparisonMode = false;
        
        // Ëé∑ÂèñÁîªÂ∏ÉÂíå‰∏ä‰∏ãÊñá
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        
        // ÂèÇÊï∞ÊéßÂà∂ÂÖÉÁ¥†
        const controls = {
            inChannels: document.getElementById('in-channels'),
            outChannels: document.getElementById('out-channels'),
            scaleFactor: document.getElementById('scale-factor'),
            kernelSize: document.getElementById('kernel-size'),
            interpMode: document.getElementById('interp-mode'),
            inputResolution: document.getElementById('input-resolution')
        };
        
        // ÂèÇÊï∞ÊòæÁ§∫ÂÖÉÁ¥†
        const displays = {
            inChannels: document.getElementById('in-channels-value'),
            outChannels: document.getElementById('out-channels-value'),
            scaleFactor: document.getElementById('scale-factor-value'),
            kernelSize: document.getElementById('kernel-size-value'),
            inputResolution: document.getElementById('input-resolution-value')
        };
        
        // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function initializeControls() {
            Object.keys(controls).forEach(key => {
                if (controls[key]) {
                    controls[key].addEventListener('input', updateVisualization);
                }
            });
        }
        
        // Ëé∑ÂèñÂΩìÂâçÂèÇÊï∞ÂÄº
        function getParameters() {
            return {
                inChannels: parseInt(controls.inChannels.value),
                outChannels: parseInt(controls.outChannels.value),
                scaleFactor: parseInt(controls.scaleFactor.value),
                kernelSize: parseInt(controls.kernelSize.value),
                interpMode: controls.interpMode.value,
                inputResolution: parseInt(controls.inputResolution.value)
            };
        }
        
        // Êõ¥Êñ∞ÊòæÁ§∫ÂÄº
        function updateDisplays() {
            const params = getParameters();
            displays.inChannels.textContent = params.inChannels;
            displays.outChannels.textContent = params.outChannels;
            displays.scaleFactor.textContent = params.scaleFactor;
            displays.kernelSize.textContent = params.kernelSize;
            displays.inputResolution.textContent = params.inputResolution;
            
            // Êõ¥Êñ∞ÊµÅÁ®ãÂõæ
            document.getElementById('input-size').textContent = 
                `[B, ${params.inChannels}, ${params.inputResolution}, ${params.inputResolution}]`;
            document.getElementById('output-size').textContent = 
                `[B, ${params.outChannels}, ${params.inputResolution * params.scaleFactor}, ${params.inputResolution * params.scaleFactor}]`;
            document.getElementById('upsample-info').textContent = `scale=${params.scaleFactor}x`;
            document.getElementById('conv-info').textContent = `${params.kernelSize}x${params.kernelSize}Âç∑ÁßØ`;
        }
        
        // ÁªòÂà∂ÁâπÂæÅÂõæ
        function drawFeatureMap(x, y, width, height, channels, resolution, label, color = '#3498db') {
            // ÁªòÂà∂‰∏ª‰Ωì
            ctx.fillStyle = color;
            ctx.fillRect(x, y, width, height);
            
            // ÁªòÂà∂ËæπÊ°Ü
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            
            // ÁªòÂà∂ÁΩëÊ†ºÔºàË°®Á§∫ÂÉèÁ¥†Ôºâ
            ctx.strokeStyle = '#ecf0f1';
            ctx.lineWidth = 1;
            const cellWidth = width / Math.min(resolution, 8);
            const cellHeight = height / Math.min(resolution, 8);
            
            for (let i = 1; i < Math.min(resolution, 8); i++) {
                // ÂûÇÁõ¥Á∫ø
                ctx.beginPath();
                ctx.moveTo(x + i * cellWidth, y);
                ctx.lineTo(x + i * cellWidth, y + height);
                ctx.stroke();
                
                // Ê∞¥Âπ≥Á∫ø
                ctx.beginPath();
                ctx.moveTo(x, y + i * cellHeight);
                ctx.lineTo(x + width, y + i * cellHeight);
                ctx.stroke();
            }
            
            // ÁªòÂà∂Ê†áÁ≠æ
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(label, x + width/2, y + height + 20);
            
            // ÁªòÂà∂Â∞∫ÂØ∏‰ø°ÊÅØ
            ctx.font = '10px Arial';
            ctx.fillStyle = 'white';
            ctx.fillText(`${channels}ch`, x + width/2, y + 15);
            ctx.fillText(`${resolution}√ó${resolution}`, x + width/2, y + height/2);
        }
        
        // ÁªòÂà∂ÁÆ≠Â§¥
        function drawArrow(fromX, fromY, toX, toY, label = '', color = '#e74c3c') {
            const headlen = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), 
                      toY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), 
                      toY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
            
            if (label) {
                ctx.fillStyle = color;
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(label, (fromX + toX) / 2, (fromY + toY) / 2 - 10);
            }
        }
        
        // ÁªòÂà∂Êìç‰ΩúËØ¥Êòé
        function drawOperation(x, y, width, height, text, color = '#f39c12') {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, width, height);
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(text, x + width/2, y + height/2 + 5);
        }
        
        // ‰∏ªË¶ÅÂèØËßÜÂåñÂáΩÊï∞
        function drawVisualization() {
            const params = getParameters();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ÁªòÂà∂Ê†áÈ¢ò
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ConvUpSampleÂ∑•‰ΩúÊµÅÁ®ãÂèØËßÜÂåñ', canvas.width / 2, 40);
            
            // ËÆ°ÁÆó‰ΩçÁΩÆ
            const startX = 50;
            const stepWidth = 150;
            const stepHeight = 120;
            const y = 200;
            const arrowY = y + stepHeight / 2;
            
            // 1. ËæìÂÖ•ÁâπÂæÅÂõæ
            drawFeatureMap(startX, y, stepWidth, stepHeight, params.inChannels, 
                          params.inputResolution, 
                          `ËæìÂÖ•ÁâπÂæÅÂõæ\n${params.inChannels}ch, ${params.inputResolution}√ó${params.inputResolution}`, 
                          '#e74c3c');
            
            // ÁÆ≠Â§¥1
            drawArrow(startX + stepWidth + 10, arrowY, startX + stepWidth + 60, arrowY);
            
            // 2. UpsampleÊìç‰Ωú
            const upsampleX = startX + stepWidth + 70;
            drawOperation(upsampleX, y + 40, 120, 40, 'nn.Upsample', '#f39c12');
            ctx.fillStyle = '#2c3e50';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`scale_factor=${params.scaleFactor}`, upsampleX + 60, y + 25);
            ctx.fillText(`mode="${params.interpMode}"`, upsampleX + 60, y + 105);
            
            // ÁÆ≠Â§¥2  
            drawArrow(upsampleX + 120 + 10, arrowY, upsampleX + 120 + 60, arrowY);
            
            // 3. ‰∏≠Èó¥ÁâπÂæÅÂõæÔºà‰∏äÈááÊ†∑ÂêéÔºâ
            const midX = upsampleX + 190;
            const newResolution = params.inputResolution * params.scaleFactor;
            drawFeatureMap(midX, y, stepWidth, stepHeight, params.inChannels, 
                          newResolution, 
                          `‰∏äÈááÊ†∑Âêé\n${params.inChannels}ch, ${newResolution}√ó${newResolution}`, 
                          '#f39c12');
            
            // ÁÆ≠Â§¥3
            drawArrow(midX + stepWidth + 10, arrowY, midX + stepWidth + 60, arrowY);
            
            // 4. Conv2dÊìç‰Ωú
            const convX = midX + stepWidth + 70;
            drawOperation(convX, y + 40, 120, 40, 'nn.Conv2d', '#27ae60');
            ctx.fillStyle = '#2c3e50';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`${params.kernelSize}√ó${params.kernelSize} kernel`, convX + 60, y + 25);
            ctx.fillText(`${params.inChannels}‚Üí${params.outChannels}ch`, convX + 60, y + 105);
            
            // ÁÆ≠Â§¥4
            drawArrow(convX + 120 + 10, arrowY, convX + 120 + 60, arrowY);
            
            // 5. ËæìÂá∫ÁâπÂæÅÂõæ
            const outX = convX + 190;
            drawFeatureMap(outX, y, stepWidth, stepHeight, params.outChannels, 
                          newResolution, 
                          `ËæìÂá∫ÁâπÂæÅÂõæ\n${params.outChannels}ch, ${newResolution}√ó${newResolution}`, 
                          '#9b59b6');
            
            // ÁªòÂà∂ÂèÇÊï∞‰ø°ÊÅØ
            drawParameterInfo(params);
            
            // ÁªòÂà∂ÊÄßËÉΩÂØπÊØîÔºàÂ¶ÇÊûúÂú®ÂØπÊØîÊ®°ÂºèÔºâ
            if (comparisonMode) {
                drawComparisonInfo();
            }
        }
        
        // ÁªòÂà∂ÂèÇÊï∞‰ø°ÊÅØ
        function drawParameterInfo(params) {
            const infoY = 400;
            ctx.fillStyle = '#34495e';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('üìä ÂΩìÂâçÈÖçÁΩÆÂèÇÊï∞Ôºö', 50, infoY);
            
            ctx.font = '14px Arial';
            const infoItems = [
                `ËæìÂÖ•ÈÄöÈÅì: ${params.inChannels}`,
                `ËæìÂá∫ÈÄöÈÅì: ${params.outChannels}`,
                `‰∏äÈááÊ†∑ÂÄçÊï∞: ${params.scaleFactor}x`,
                `Âç∑ÁßØÊ†∏: ${params.kernelSize}√ó${params.kernelSize}`,
                `ÊèíÂÄºÊ®°Âºè: ${params.interpMode}`,
                `ÂàÜËæ®ÁéáÂèòÂåñ: ${params.inputResolution}√ó${params.inputResolution} ‚Üí ${params.inputResolution * params.scaleFactor}√ó${params.inputResolution * params.scaleFactor}`
            ];
            
            infoItems.forEach((item, index) => {
                const x = 50 + (index % 3) * 250;
                const y = infoY + 30 + Math.floor(index / 3) * 25;
                ctx.fillText(item, x, y);
            });
        }
        
        // ÁªòÂà∂ÂØπÊØî‰ø°ÊÅØ
        function drawComparisonInfo() {
            const compY = 500;
            ctx.fillStyle = '#e74c3c';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('‚öñÔ∏è ConvUpSample vs ‰º†ÁªüËΩ¨ÁΩÆÂç∑ÁßØ', canvas.width / 2, compY);
            
            // ÂØπÊØîË°®Ê†º
            const tableData = [
                ['ÊåáÊ†á', 'ConvUpSample', 'ËΩ¨ÁΩÆÂç∑ÁßØ'],
                ['ËÆ°ÁÆóÂ§çÊùÇÂ∫¶', '‰Ωé', 'È´ò'],
                ['Ê£ãÁõò‰º™ÂΩ±', 'Êó†', 'Êúâ'],
                ['ËÆ≠ÁªÉÁ®≥ÂÆöÊÄß', 'È´ò', '‰∏≠'],
                ['ÂèÇÊï∞ÊéßÂà∂', 'Á≤æÁ°Æ', 'Âõ∞Èöæ'],
                ['ÂÜÖÂ≠ò‰ΩøÁî®', '‰Ωé', 'È´ò']
            ];
            
            const cellWidth = 120;
            const cellHeight = 25;
            const tableX = (canvas.width - cellWidth * 3) / 2;
            let tableY = compY + 20;
            
            tableData.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const x = tableX + colIndex * cellWidth;
                    const y = tableY + rowIndex * cellHeight;
                    
                    // ÁªòÂà∂ÂçïÂÖÉÊ†ºËÉåÊôØ
                    if (rowIndex === 0) {
                        ctx.fillStyle = '#3498db';
                    } else if (colIndex === 1) {
                        ctx.fillStyle = '#e8f5e8';
                    } else if (colIndex === 2) {
                        ctx.fillStyle = '#ffe8e8';
                    } else {
                        ctx.fillStyle = '#f8f9ff';
                    }
                    ctx.fillRect(x, y, cellWidth, cellHeight);
                    
                    // ÁªòÂà∂ËæπÊ°Ü
                    ctx.strokeStyle = '#2c3e50';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(x, y, cellWidth, cellHeight);
                    
                    // ÁªòÂà∂ÊñáÂ≠ó
                    ctx.fillStyle = rowIndex === 0 ? 'white' : '#2c3e50';
                    ctx.font = rowIndex === 0 ? 'bold 12px Arial' : '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(cell, x + cellWidth/2, y + cellHeight/2 + 4);
                });
            });
        }
        
        // Âä®ÁîªÊºîÁ§∫
        function startAnimation() {
            if (isAnimating) return;
            isAnimating = true;
            currentStep = 0;
            document.getElementById('animation-status').textContent = 'üé¨ Âä®ÁîªÊºîÁ§∫‰∏≠...';
            animateStep();
        }
        
        function animateStep() {
            if (!isAnimating || currentStep >= 4) {
                isAnimating = false;
                document.getElementById('animation-status').textContent = '‚úÖ Âä®ÁîªÊºîÁ§∫ÂÆåÊàê';
                return;
            }
            
            const steps = [
                'üì• ËæìÂÖ•ÁâπÂæÅÂõæÂáÜÂ§áÂ∞±Áª™',
                'üîÑ ÊâßË°åUpsample‰∏äÈááÊ†∑Êìç‰Ωú',
                '‚öôÔ∏è ÊâßË°åConv2dÂç∑ÁßØÊìç‰Ωú', 
                'üì§ ÁîüÊàêÊúÄÁªàËæìÂá∫ÁâπÂæÅÂõæ'
            ];
            
            document.getElementById('animation-status').textContent = steps[currentStep];
            
            // È´ò‰∫ÆÂΩìÂâçÊ≠•È™§
            drawVisualization();
            highlightCurrentStep();
            
            currentStep++;
            setTimeout(animateStep, 2000);
        }
        
        function highlightCurrentStep() {
            // Ê†πÊçÆÂΩìÂâçÊ≠•È™§Ê∑ªÂä†È´ò‰∫ÆÊïàÊûú
            const params = getParameters();
            const stepWidth = 150;
            const y = 200;
            const startX = 50;
            
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 4;
            ctx.setLineDash([10, 5]);
            
            switch(currentStep) {
                case 0:
                    ctx.strokeRect(startX - 5, y - 5, stepWidth + 10, 120 + 10);
                    break;
                case 1:
                    const upsampleX = startX + stepWidth + 70;
                    ctx.strokeRect(upsampleX - 5, y + 35, 130, 50);
                    break;
                case 2:
                    const convX = startX + stepWidth + 70 + 190 + stepWidth + 70;
                    ctx.strokeRect(convX - 5, y + 35, 130, 50);
                    break;
                case 3:
                    const outX = startX + stepWidth + 70 + 190 + stepWidth + 70 + 190;
                    ctx.strokeRect(outX - 5, y - 5, stepWidth + 10, 120 + 10);
                    break;
            }
            ctx.setLineDash([]);
        }
        
        // ÈáçÁΩÆÊºîÁ§∫
        function resetDemo() {
            isAnimating = false;
            clearTimeout(animationId);
            currentStep = 0;
            
            // ÈáçÁΩÆÂèÇÊï∞Âà∞ÈªòËÆ§ÂÄº
            controls.inChannels.value = 64;
            controls.outChannels.value = 32;
            controls.scaleFactor.value = 2;
            controls.kernelSize.value = 1;
            controls.interpMode.value = 'nearest';
            controls.inputResolution.value = 32;
            
            updateVisualization();
            document.getElementById('animation-status').textContent = 'üîÑ Â∑≤ÈáçÁΩÆÂà∞ÈªòËÆ§ÂèÇÊï∞';
        }
        
        // ÂàáÊç¢ÂØπÊØîÊ®°Âºè
        function toggleComparison() {
            comparisonMode = !comparisonMode;
            const button = event.target;
            if (comparisonMode) {
                button.textContent = 'üìä ÈÄÄÂá∫ÂØπÊØî';
                button.style.background = '#27ae60';
                document.getElementById('animation-status').textContent = '‚öñÔ∏è ÂØπÊØîÊ®°ÂºèÔºöConvUpSample vs ËΩ¨ÁΩÆÂç∑ÁßØ';
            } else {
                button.textContent = '‚öñÔ∏è ÂØπÊØîÊ®°Âºè';
                button.style.background = '#e74c3c';
                document.getElementById('animation-status').textContent = 'üìä Â∑≤ÈÄÄÂá∫ÂØπÊØîÊ®°Âºè';
            }
            drawVisualization();
        }
        
        // Êõ¥Êñ∞ÂèØËßÜÂåñ
        function updateVisualization() {
            updateDisplays();
            drawVisualization();
        }
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeControls();
            updateVisualization();
        });
    </script>
</body>
</html>